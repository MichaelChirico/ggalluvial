<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Labeling small strata • ggalluvial</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Labeling small strata">
<meta property="og:description" content="ggalluvial">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ggalluvial</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.12.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ggalluvial.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/labels.html">Labeling small strata</a>
    </li>
    <li>
      <a href="../articles/order-rectangles.html">The Order of the Rectangles</a>
    </li>
    <li>
      <a href="../articles/shiny.html">Tooltips for ggalluvial plots in Shiny apps</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/corybrunson/ggalluvial/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="labels_files/header-attrs-2.10/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Labeling small strata</h1>
                        <h4 class="author">Jason Cory Brunson</h4>
            
            <h4 class="date">2021-09-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/corybrunson/ggalluvial/blob/master/vignettes/labels.rmd"><code>vignettes/labels.rmd</code></a></small>
      <div class="hidden name"><code>labels.rmd</code></div>

    </div>

    
    
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>This brief vignette uses the <code>vaccinations</code> dataset included in <strong>ggalluvial</strong>. As in <a href="http://corybrunson.github.io/ggalluvial/articles/ggalluvial.html">the technical introduction</a>, the order of the levels is reversed to be more intuitive. Objects from other <strong>ggplot2</strong> extensions are accessed via <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">::</a></code> and <code><a href="https://rdrr.io/r/base/ns-dblcolon.html">:::</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>fig.width <span class="op">=</span> <span class="fl">6</span>, fig.height <span class="op">=</span> <span class="fl">4</span>, fig.align <span class="op">=</span> <span class="st">"center"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://corybrunson.github.io/ggalluvial/">ggalluvial</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: ggplot2</code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">vaccinations</span><span class="op">)</span>
<span class="va">vaccinations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span><span class="va">vaccinations</span>,
                          response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">response</span>, <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="problem" class="section level2">
<h2 class="hasAnchor">
<a href="#problem" class="anchor"></a>Problem</h2>
<p>The issue on the table: Strata are most helpful when they’re overlaid with text labels. Yet the strata often vary in height, and the labels in length, to such a degree that fitting the text inside the strata at a uniform size renders them illegible. In principle, the user could treat <code>size</code> as a variable aesthetic and manually fit text to strata, but this is cumbersome, and doesn’t help anyway in cases where large text is needed.</p>
<p>To illustrate the problem, check out the plot below. It’s by no means an egregious case, but it’ll do. (For a more practical example, see <a href="https://stackoverflow.com/questions/50720718/labelling-and-theme-of-ggalluvial-plot-in-r">this question on StackOverflow</a>, which prompted this vignette.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">vaccinations</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey</span>, stratum <span class="op">=</span> <span class="va">response</span>, alluvium <span class="op">=</span> <span class="va">subject</span>, y <span class="op">=</span> <span class="va">freq</span>,
           fill <span class="op">=</span> <span class="va">response</span>, label <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_flow.html">geom_flow</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"vaccination survey responses"</span>, <span class="st">"labeled using `geom_text()`"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: The `.dots` argument of `group_by()` is deprecated as of dplyr 1.0.0.</code></pre>
<p><img src="labels_files/figure-html/raw-1.png" width="576" style="display: block; margin: auto;"></p>
<div id="fix" class="section level3">
<h3 class="hasAnchor">
<a href="#fix" class="anchor"></a>Fix</h3>
<p>One option is to simply omit those labels that don’t fit within their strata. In response to <a href="https://github.com/corybrunson/ggalluvial/issues/27">an issue</a>, <code>v0.9.2</code> includes parameters in <code><a href="../reference/stat_stratum.html">stat_stratum()</a></code> to exclude strata outside a specified height range; while few would use this to omit the rectangles themselves, it can be used in tandem with <code>geom_text()</code> to shirk this problem, at least when the labels are concise:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">vaccinations</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey</span>, stratum <span class="op">=</span> <span class="va">response</span>, alluvium <span class="op">=</span> <span class="va">subject</span>, y <span class="op">=</span> <span class="va">freq</span>,
           fill <span class="op">=</span> <span class="va">response</span>, label <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_flow.html">geom_flow</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">4</span>, min.y <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span>
    <span class="st">"vaccination survey responses"</span>,
    <span class="st">"labeled using `geom_text()` with `min.y = 100`"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="labels_files/figure-html/omit-1.png" width="576" style="display: block; margin: auto;"></p>
<p>This is a useful fix for some cases. Still, if the goal is a publication-ready graphic, then it reaffirms the need for more adaptable and elegant solutions. Fortunately, two wonderful packages deliver with, shall we say, flowing colors.</p>
</div>
</div>
<div id="solutions" class="section level2">
<h2 class="hasAnchor">
<a href="#solutions" class="anchor"></a>Solutions</h2>
<p>Two <strong>ggplot2</strong> extensions are well-suited to this problem: <a href="https://github.com/slowkow/ggrepel"><strong>ggrepel</strong></a> and <a href="https://github.com/wilkox/ggfittext"><strong>ggfittext</strong></a>. They provide new geom layers that use the output of existing stat layers to situate text: <code><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">ggrepel::geom_text_repel()</a></code> takes the same aesthetics as <code><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">ggplot2::geom_text()</a></code>, namely <code>x</code>, <code>y</code>, and <code>label</code>. In contrast, <code><a href="https://wilkox.org/ggfittext/reference/geom_fit_text.html">ggfittext::geom_fit_text()</a></code> only specifically requires <code>label</code> but also needs enough information to determine the rectangle that will contain the text. This can be encoded as <code>xmin</code> and <code>xmax</code> or as <code>x</code> and <code>width</code> for the horizontal direction, and as <code>ymin</code> and <code>ymax</code> or as <code>y</code> and <code>height</code> for the vertical direction. Conveniently, <code><a href="../reference/stat_stratum.html">ggalluvial::stat_stratum()</a></code> produces more than enough information for both geoms, including <code>x</code>, <code>xmin</code>, <code>xmax</code>, and their vertical counterparts.</p>
<p>All this can be gleaned from the <code>ggproto</code> objects that construct the layers:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">ggrepel</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/ggrepel/man/ggrepel-ggproto.html">GeomTextRepel</a></span><span class="op">$</span><span class="va">required_aes</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "x"     "y"     "label"</code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">ggfittext</span><span class="fu">:::</span><span class="va">GeomFitText</span><span class="op">$</span><span class="va">required_aes</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "label"</code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu">ggfittext</span><span class="fu">:::</span><span class="va">GeomFitText</span><span class="op">$</span><span class="va">setup_data</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ggproto method&gt;
##   &lt;Wrapper function&gt;
##     function (...) 
## f(...)
## 
##   &lt;Inner function (f)&gt;
##     function (data, params) 
## {
##     if (!(("xmin" %in% names(data) &amp; "xmax" %in% names(data)) | 
##         ("x" %in% names(data)))) {
##         stop("geom_fit_text needs either 'xmin' and 'xmax', or 'x'", 
##             .call = FALSE)
##     }
##     if (!("ymin" %in% names(data) &amp; "ymax" %in% names(data) | 
##         "y" %in% names(data))) {
##         stop("geom_fit_text needs either 'ymin' and 'ymax', or 'y'", 
##             .call = FALSE)
##     }
##     if ((!is.null(params$width)) &amp; (!"unit" %in% class(params$width))) {
##         data$xmin &lt;- data$x - params$width/2
##         data$xmax &lt;- data$x + params$width/2
##     }
##     if ((!is.null(params$height)) &amp; (!"unit" %in% class(params$height))) {
##         data$ymin &lt;- data$y - params$height/2
##         data$ymax &lt;- data$y + params$height/2
##     }
##     if (is.null(params$width) &amp; !"xmin" %in% names(data)) {
##         data$width &lt;- ggplot2::resolution(data$x, FALSE) * 0.9
##         data$xmin &lt;- data$x - data$width/2
##         data$xmax &lt;- data$x + data$width/2
##         data$width &lt;- NULL
##     }
##     if (is.null(params$height) &amp; !"ymin" %in% names(data)) {
##         data$height &lt;- ggplot2::resolution(data$y, FALSE) * 0.9
##         data$ymin &lt;- data$y - data$height/2
##         data$ymax &lt;- data$y + data$height/2
##         data$height &lt;- NULL
##     }
##     if (!is.null(params$formatter)) {
##         if (!is.function(params$formatter)) {
##             stop("`formatter` must be a function")
##         }
##         formatted_labels &lt;- sapply(data$label, params$formatter, 
##             USE.NAMES = FALSE)
##         if ((!length(formatted_labels) == length(data$label)) | 
##             (!is.character(formatted_labels))) {
##             stop("`formatter` must produce a character vector of same length as input")
##         }
##         data$label &lt;- formatted_labels
##     }
##     data
## }</code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">StatStratum</span><span class="op">$</span><span class="va">compute_panel</span><span class="op">)</span></code></pre></div>
<pre><code>## &lt;ggproto method&gt;
##   &lt;Wrapper function&gt;
##     function (...) 
## f(..., self = self)
## 
##   &lt;Inner function (f)&gt;
##     function (self, data, scales, decreasing = NULL, reverse = NULL, 
##     absolute = NULL, discern = FALSE, distill = first, negate.strata = NULL, 
##     infer.label = FALSE, label.strata = NULL, min.y = NULL, max.y = NULL, 
##     min.height = NULL, max.height = NULL) 
## {
##     if (is.null(decreasing)) 
##         decreasing &lt;- ggalluvial_opt("decreasing")
##     if (is.null(reverse)) 
##         reverse &lt;- ggalluvial_opt("reverse")
##     if (is.null(absolute)) 
##         absolute &lt;- ggalluvial_opt("absolute")
##     if (!is.null(label.strata)) {
##         defunct_parameter("label.strata", msg = "use `aes(label = after_stat(stratum))`.")
##         infer.label &lt;- label.strata
##     }
##     if (infer.label) {
##         deprecate_parameter("infer.label", msg = "Use `aes(label = after_stat(stratum))`.")
##         if (is.null(data$label)) {
##             data$label &lt;- data$stratum
##         }
##         else {
##             warning("Aesthetic `label` is specified, ", "so parameter `infer.label` will be ignored.")
##         }
##     }
##     diff_aes &lt;- intersect(c(.color_diff_aesthetics, .text_aesthetics), 
##         names(data))
##     data$yneg &lt;- data$y &lt; 0
##     data$lode &lt;- data$alluvium
##     distill &lt;- distill_fun(distill)
##     weight &lt;- data$weight
##     data$weight &lt;- NULL
##     if (is.null(weight)) 
##         weight &lt;- 1
##     data$n &lt;- weight
##     data$count &lt;- data$y * weight
##     by_vars &lt;- c("x", "yneg", "stratum")
##     only_vars &lt;- c(diff_aes)
##     sum_vars &lt;- c("y", "n", "count")
##     if (!is.null(data$lode)) {
##         agg_lode &lt;- stats::aggregate(data[, "lode", drop = FALSE], 
##             data[, by_vars], distill)
##     }
##     if (length(only_vars) &gt; 0) {
##         agg_only &lt;- stats::aggregate(data[, only_vars, drop = FALSE], 
##             data[, by_vars], only)
##     }
##     data &lt;- stats::aggregate(data[, sum_vars], data[, by_vars], 
##         sum)
##     if (!is.null(data$lode)) {
##         data &lt;- merge(data, agg_lode)
##     }
##     if (length(only_vars) &gt; 0) {
##         data &lt;- merge(data, agg_only)
##     }
##     data &lt;- subset(data, y != 0)
##     data &lt;- deposit_data(data, decreasing, reverse, absolute)
##     x_sums &lt;- tapply(abs(data$count), data$x, sum, na.rm = TRUE)
##     data$prop &lt;- data$count/x_sums[match(as.character(data$x), 
##         names(x_sums))]
##     data &lt;- data[with(data, order(deposit)), , drop = FALSE]
##     data$ycum &lt;- NA
##     for (xx in unique(data$x)) {
##         for (yn in c(FALSE, TRUE)) {
##             ww &lt;- which(data$x == xx &amp; data$yneg == yn)
##             data$ycum[ww] &lt;- cumulate(data$y[ww])
##         }
##     }
##     data$ymin &lt;- data$ycum - abs(data$y)/2
##     data$ymax &lt;- data$ycum + abs(data$y)/2
##     data$y &lt;- data$ycum
##     data$yneg &lt;- NULL
##     data$ycum &lt;- NULL
##     if (!is.null(min.height)) {
##         deprecate_parameter("min.height", "min.y")
##         min.y &lt;- min.height
##     }
##     if (!is.null(max.height)) {
##         deprecate_parameter("max.height", "max.y")
##         max.y &lt;- max.height
##     }
##     if (!is.null(min.y)) 
##         data &lt;- subset(data, ymax - ymin &gt;= min.y)
##     if (!is.null(max.y)) 
##         data &lt;- subset(data, ymax - ymin &lt;= max.y)
##     data
## }</code></pre>
<p>I reached the specific solutions through trial and error. They may not be the best tricks for most cases, but they demonstrate what these packages can do. For many more examples, see the respective package vignettes: <a href="https://CRAN.R-project.org/package=ggrepel/vignettes/ggrepel.html">for <strong>ggrepel</strong></a>, and <a href="https://CRAN.R-project.org/package=ggfittext/vignettes/introduction-to-ggfittext.html">for <strong>ggfittext</strong></a>.</p>
<div id="solution-1-ggrepel" class="section level3">
<h3 class="hasAnchor">
<a href="#solution-1-ggrepel" class="anchor"></a>Solution 1: <strong>ggrepel</strong>
</h3>
<p><strong>ggrepel</strong> is most often (in my experience) used to repel text away from symbols in a scatterplot, in whatever directions prevent them from overlapping the symbols and each other. In this case, however, it makes much more sense to align them vertically a fixed horizontal distance (<code>nudge_x</code>) away from the strata and repel them vertically from each other (<code>direction = "y"</code>) just enough to print them without overlap. It takes an extra bit of effort to render text <em>only</em> for the strata at the first (or at the last) axis, but the result is worth it.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">vaccinations</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey</span>, stratum <span class="op">=</span> <span class="va">response</span>, alluvium <span class="op">=</span> <span class="va">subject</span>, y <span class="op">=</span> <span class="va">freq</span>,
           fill <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.4</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_flow.html">geom_flow</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_linetype_manual</span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blank"</span>, <span class="st">"solid"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">survey</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,
    stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">4</span>, direction <span class="op">=</span> <span class="st">"y"</span>, nudge_x <span class="op">=</span> <span class="op">-</span><span class="fl">.5</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_text_repel</a></span><span class="op">(</span>
    <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">survey</span><span class="op">)</span> <span class="op">==</span> <span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">response</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span>,
    stat <span class="op">=</span> <span class="st">"stratum"</span>, size <span class="op">=</span> <span class="fl">4</span>, direction <span class="op">=</span> <span class="st">"y"</span>, nudge_x <span class="op">=</span> <span class="fl">.5</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"vaccination survey responses"</span>, <span class="st">"labeled using `geom_text_repel()`"</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: Removed 8 rows containing missing values (geom_text_repel).

## Warning: Removed 8 rows containing missing values (geom_text_repel).</code></pre>
<p><img src="labels_files/figure-html/ggrepel-1.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div id="solution-2-ggfittext" class="section level3">
<h3 class="hasAnchor">
<a href="#solution-2-ggfittext" class="anchor"></a>Solution 2: <strong>ggfittext</strong>
</h3>
<p><strong>ggfittext</strong> is simplicity itself: The strata are just rectangles, so no more parameter specifications are necessary to fit the text into them. One key parameter is <code>min.size</code>, which defaults to <code>4</code> and controls how small the text is allowed to get without being omitted.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span><span class="va">vaccinations</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">survey</span>, stratum <span class="op">=</span> <span class="va">response</span>, alluvium <span class="op">=</span> <span class="va">subject</span>, y <span class="op">=</span> <span class="va">freq</span>,
           fill <span class="op">=</span> <span class="va">response</span>, label <span class="op">=</span> <span class="va">response</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_flow.html">geom_flow</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="../reference/geom_stratum.html">geom_stratum</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.5</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggfittext</span><span class="fu">::</span><span class="fu"><a href="https://wilkox.org/ggfittext/reference/geom_fit_text.html">geom_fit_text</a></span><span class="op">(</span>stat <span class="op">=</span> <span class="st">"stratum"</span>, width <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, min.size <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"vaccination survey responses"</span>, <span class="st">"labeled using `geom_fit_text()`"</span><span class="op">)</span></code></pre></div>
<p><img src="labels_files/figure-html/ggfittext-1.png" width="576" style="display: block; margin: auto;"></p>
<p>Note that this solution requires <strong>ggfittext</strong> v0.6.0.</p>
</div>
</div>
<div id="appendix" class="section level2">
<h2 class="hasAnchor">
<a href="#appendix" class="anchor"></a>Appendix</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">sessioninfo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code>## ─ Session info ───────────────────────────────────────────────────────────────
##  setting  value                       
##  version  R version 4.1.1 (2021-08-10)
##  os       macOS Big Sur 10.16         
##  system   x86_64, darwin17.0          
##  ui       X11                         
##  language (EN)                        
##  collate  en_US.UTF-8                 
##  ctype    en_US.UTF-8                 
##  tz       America/New_York            
##  date     2021-09-06                  
## 
## ─ Packages ───────────────────────────────────────────────────────────────────
##  package     * version date       lib source        
##  assertthat    0.2.1   2019-03-21 [2] CRAN (R 4.1.0)
##  bslib         0.2.5.1 2021-05-18 [2] CRAN (R 4.1.0)
##  cachem        1.0.6   2021-08-19 [2] CRAN (R 4.1.0)
##  cli           3.0.1   2021-07-17 [2] CRAN (R 4.1.0)
##  colorspace    2.0-2   2021-06-24 [2] CRAN (R 4.1.0)
##  crayon        1.4.1   2021-02-08 [2] CRAN (R 4.1.0)
##  DBI           1.1.1   2021-01-15 [2] CRAN (R 4.1.0)
##  desc          1.3.0   2021-03-05 [2] CRAN (R 4.1.0)
##  digest        0.6.27  2020-10-24 [2] CRAN (R 4.1.0)
##  dplyr         1.0.7   2021-06-18 [2] CRAN (R 4.1.0)
##  ellipsis      0.3.2   2021-04-29 [2] CRAN (R 4.1.0)
##  evaluate      0.14    2019-05-28 [2] CRAN (R 4.1.0)
##  fansi         0.5.0   2021-05-25 [2] CRAN (R 4.1.0)
##  farver        2.1.0   2021-02-28 [2] CRAN (R 4.1.0)
##  fastmap       1.1.0   2021-01-25 [2] CRAN (R 4.1.0)
##  fs            1.5.0   2020-07-31 [2] CRAN (R 4.1.0)
##  generics      0.1.0   2020-10-31 [2] CRAN (R 4.1.0)
##  ggalluvial  * 0.12.3  2021-09-06 [1] local         
##  ggfittext     0.9.1   2021-01-30 [2] CRAN (R 4.1.0)
##  ggplot2     * 3.3.5   2021-06-25 [2] CRAN (R 4.1.0)
##  ggrepel       0.9.1   2021-01-15 [2] CRAN (R 4.1.0)
##  glue          1.4.2   2020-08-27 [2] CRAN (R 4.1.0)
##  gtable        0.3.0   2019-03-25 [2] CRAN (R 4.1.0)
##  highr         0.9     2021-04-16 [2] CRAN (R 4.1.0)
##  htmltools     0.5.2   2021-08-25 [2] CRAN (R 4.1.0)
##  jquerylib     0.1.4   2021-04-26 [2] CRAN (R 4.1.0)
##  jsonlite      1.7.2   2020-12-09 [2] CRAN (R 4.1.0)
##  knitr         1.33    2021-04-24 [2] CRAN (R 4.1.0)
##  labeling      0.4.2   2020-10-20 [2] CRAN (R 4.1.0)
##  lifecycle     1.0.0   2021-02-15 [2] CRAN (R 4.1.0)
##  magrittr      2.0.1   2020-11-17 [2] CRAN (R 4.1.0)
##  memoise       2.0.0   2021-01-26 [2] CRAN (R 4.1.0)
##  munsell       0.5.0   2018-06-12 [2] CRAN (R 4.1.0)
##  pillar        1.6.2   2021-07-29 [2] CRAN (R 4.1.0)
##  pkgconfig     2.0.3   2019-09-22 [2] CRAN (R 4.1.0)
##  pkgdown       1.6.1   2020-09-12 [2] CRAN (R 4.1.0)
##  purrr         0.3.4   2020-04-17 [2] CRAN (R 4.1.0)
##  R6            2.5.1   2021-08-19 [2] CRAN (R 4.1.0)
##  ragg          1.1.3   2021-06-09 [2] CRAN (R 4.1.0)
##  Rcpp          1.0.7   2021-07-07 [2] CRAN (R 4.1.0)
##  rlang         0.4.11  2021-04-30 [2] CRAN (R 4.1.0)
##  rmarkdown     2.10    2021-08-06 [2] CRAN (R 4.1.0)
##  rprojroot     2.0.2   2020-11-15 [2] CRAN (R 4.1.0)
##  rstudioapi    0.13    2020-11-12 [2] CRAN (R 4.1.0)
##  sass          0.4.0   2021-05-12 [2] CRAN (R 4.1.0)
##  scales        1.1.1   2020-05-11 [2] CRAN (R 4.1.0)
##  sessioninfo   1.1.1   2018-11-05 [2] CRAN (R 4.1.0)
##  stringi       1.7.4   2021-08-25 [2] CRAN (R 4.1.0)
##  stringr       1.4.0   2019-02-10 [2] CRAN (R 4.1.0)
##  systemfonts   1.0.2   2021-05-11 [2] CRAN (R 4.1.0)
##  textshaping   0.3.5   2021-06-09 [2] CRAN (R 4.1.0)
##  tibble        3.1.4   2021-08-25 [2] CRAN (R 4.1.0)
##  tidyr         1.1.3   2021-03-03 [2] CRAN (R 4.1.0)
##  tidyselect    1.1.1   2021-04-30 [2] CRAN (R 4.1.0)
##  utf8          1.2.2   2021-07-24 [2] CRAN (R 4.1.0)
##  vctrs         0.3.8   2021-04-29 [2] CRAN (R 4.1.0)
##  withr         2.4.2   2021-04-18 [2] CRAN (R 4.1.0)
##  xfun          0.25    2021-08-06 [2] CRAN (R 4.1.0)
##  yaml          2.2.1   2020-02-01 [2] CRAN (R 4.1.0)
## 
## [1] /private/var/folders/4p/3cy0qmp15x9216qsqhh84kzm0000gn/T/RtmppTW8nm/temp_libpath1ad4ed1f6fc
## [2] /Library/Frameworks/R.framework/Versions/4.1/Resources/library</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jason Cory Brunson, Quentin D. Read.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
